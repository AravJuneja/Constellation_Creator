<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constellation Creator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: rgb(0, 0, 0);
        }
        canvas {
            border: 1px solid white;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <button onclick="saveToCSV()">Save to CSV</button>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        function generatePoints(numPoints) {
            const points = [];
            const screenMarginX = canvas.width / 4;
            const screenMarginY = canvas.height / 4;
            for (let i = 0; i < numPoints; i++) {
                const x = Math.random() * (canvas.width - 2 * screenMarginX) + screenMarginX;
                const y = Math.random() * (canvas.height - 2 * screenMarginY) + screenMarginY;
                points.push({ x, y });
            }
            return points;
        }

        function drawPoints(points) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            for (const point of points) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function printToConsole(points) {
            console.log("Generated Constellation Points:");
            for (const point of points) {
                console.log(`(${point.x}, ${point.y})`);
            }
        }

        function pointsToCSV(points) {
            return points.map(point => `${point.x},${point.y}`).join('\n');
        }

        function downloadCSV(csvData, filename) {
            const blob = new Blob([csvData], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function saveToCSV() {
            const numPoints = Math.floor(Math.random() * (15 - 3 + 1)) + 3;
            const points = generatePoints(numPoints);
            drawPoints(points);
            printToConsole(points);

            const csvData = pointsToCSV(points);
            const filename = 'constellation_points.csv';
            downloadCSV(csvData, filename);
        }
        function saveToCSV() {
            const numPoints = Math.floor(Math.random() * (15 - 3 + 1)) + 3;
            const points = generatePoints(numPoints);
            drawPoints(points);

            const csvData = pointsToCSV(points);

            // Make an AJAX request to the server-side script
            fetch('http://localhost:5001/append_points', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(csvData.split('\n')[1].split(',')), // Extracting the data row
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data saved:', data);
            })
            .catch(error => {
                console.error('Error saving data:', error);
            });
        }
        function main() {
    // Retrieve existing data from local storage
    const existingData = localStorage.getItem('constellation_points') || '';

    // Parse the existing CSV data into an array of points
    const existingPoints = existingData.split('\n').map(line => {
        const [x, y] = line.split(',').map(Number);
        return { x, y };
    });

    // Generate new points
    const numPoints = Math.floor(Math.random() * (15 - 3 + 1)) + 3;
    const newPoints = generatePoints(numPoints);

    // Combine existing and new points
    const allPoints = existingPoints.concat(newPoints);

    // Draw all points on the canvas
    drawPoints(allPoints);

    // Convert all points to CSV format
    const csvData = pointsToCSV(allPoints);

    // Save the combined CSV data to local storage
    saveToLocalStorage(csvData);

    // Make an AJAX request to the server-side script to append the new points
    fetch('http://localhost:5001/append_points', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(allPoints),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Data saved:', data);
    })
    .catch(error => {
        console.error('Error saving data:', error);
    });
}

main(); // Call main() when the page loads


        main();
    </script>
</body>
</html>
